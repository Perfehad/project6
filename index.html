<!doctype html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Сабақ кестесі</title>

<style>
body{margin:0;font-family:system-ui,Arial;background:#fff;color:#111}
.wrap{max-width:860px;margin:auto;padding:18px}
h1{text-align:center;margin-bottom:15px}
.topbar{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
.btn{padding:10px 14px;border-radius:12px;border:1px solid #ddd;background:#f7f7f7;cursor:pointer;font-weight:700}
.btn.active{border-color:#7c5cff;background:#efeaff}
.card{border:1px solid #e6e6e6;border-radius:14px;padding:14px;background:#fafafa;margin-top:15px}
.lesson{padding:8px;border-bottom:1px solid #eee}
.lesson:last-child{border-bottom:none}
.time{font-weight:900}
.timerBar{
position:fixed;left:50%;transform:translateX(-50%);
bottom:16px;width:min(860px,92%);
border-radius:16px;background:#111;color:#fff;
padding:12px 14px;display:flex;justify-content:space-between;
align-items:center;box-shadow:0 16px 50px rgba(0,0,0,.18)}
.timer{font-size:22px;font-weight:900}
.small{font-size:12px;color:#ddd}
</style>
</head>

<body>

<div class="wrap">
<h1>Сабақ кестесі</h1>
<div class="topbar" id="dayButtons"></div>

<div class="card">
<div id="dayTitle">Күнді таңдаңыз</div>
<div id="daySchedule"></div>
</div>
</div>

<div class="timerBar">
<div>
<b id="statusText">—</b>
<div class="small" id="subText">—</div>
</div>
<div class="timer" id="timerBox">00:00</div>
</div>

<script>
/* ====== ДЕРЕК ====== */
const WEEK_TEMPLATE=[
{key:"mon",kz:"Дүйсенбі",ru:"1 Күн",lessons:[
["08:00","08:45","Математика"],
["08:50","09:35","Орыс тілі"],
["09:40","10:25","Қазақ тілі"],
["10:45","11:30","Химия"],
["11:35","12:20","Биология"],
["12:25","13:10","Алғашқы әскери дайындық"],
["13:20","14:05","Дене тәрбиесі"]
]},
{key:"tue",kz:"Сейсенбі",ru:"2 Күн",lessons:[
["08:00","08:45","Химия"],
["08:50","09:35","Физика"],
["09:40","10:25","Орыс тілі"],
["10:45","11:30","Информатика"],
["11:35","12:20","Қазақ тілі"],
["12:25","13:10","Дене тәрбиесі"],
["13:20","14:05","Математика"]
]},
{key:"wed",kz:"Сәрсенбі",ru:"3 Күн",lessons:[
["08:00","08:45","Қазақстан тарихы"],
["08:50","09:35","Физика"],
["09:40","10:25","География"],
["10:45","11:30","Математика"],
["11:35","12:20","Қазақ тілі"],
["12:25","13:10","Биология"],
["13:20","14:05","Дүниежүзі тарихы"]
]},
{key:"thu",kz:"Бейсенбі",ru:"4 Күн",lessons:[
["08:00","08:45","Дене тәрбиесі"],
["08:50","09:35","Қауіпсіздік техникасы"],
["09:40","10:25","Қазақ тілі"],
["10:45","11:30","Информатика"],
["11:35","12:20","Дүниежүзі тарихы"],
["12:25","13:10","Шетел тілі"],
["13:20","14:05","Математика"]
]},
{key:"fri",kz:"Жұма",ru:"5 Күн",lessons:[
["08:00","08:45","География"],
["08:50","09:35","Графика және дизайн"],
["09:40","10:25","Қазақ тілі"],
["10:45","11:30","Дене тәрбиесі"],
["11:35","12:20","Информатика"],
["12:25","13:10","Жаһандық құзыреттілік"],
["13:20","14:05","Шетел тілі"]
]}];

/* ====== АПТА ДАТАСЫ ====== */
function getMonday(d){
let day=d.getDay();
let diff=(day===0?-6:1-day);
let m=new Date(d);
m.setDate(d.getDate()+diff);
return m;
}
function formatDate(d){
let dd=String(d.getDate()).padStart(2,"0");
let mm=String(d.getMonth()+1).padStart(2,"0");
let yyyy=d.getFullYear();
return `${dd}.${mm}.${yyyy}`;
}
function buildWeek(){
let monday=getMonday(new Date());
return WEEK_TEMPLATE.map((t,i)=>{
let d=new Date(monday);
d.setDate(monday.getDate()+i);
return {...t,dateISO:d.toISOString().split("T")[0],title:`${t.kz} — ${formatDate(d)} (${t.ru})`};
});
}
let DAYS=buildWeek();

/* ====== UI ====== */
const dayButtons=document.getElementById("dayButtons");
const dayTitle=document.getElementById("dayTitle");
const daySchedule=document.getElementById("daySchedule");

function renderButtons(){
dayButtons.innerHTML="";
DAYS.forEach(d=>{
let b=document.createElement("button");
b.className="btn";
b.textContent=d.kz;
b.onclick=()=>selectDay(d.key);
b.dataset.key=d.key;
dayButtons.appendChild(b);
});
}
function selectDay(key){
[...dayButtons.children].forEach(btn=>btn.classList.toggle("active",btn.dataset.key===key));
let day=DAYS.find(d=>d.key===key);
dayTitle.textContent=day.title;
daySchedule.innerHTML="";
day.lessons.forEach(l=>{
daySchedule.innerHTML+=`<div class="lesson"><span class="time">${l[0]}–${l[1]}</span> — ${l[2]}</div>`;
});
}

/* ====== УВЕДОМЛЕНИЕ ====== */
if("Notification"in window)Notification.requestPermission();
function notify(t,b){if(Notification.permission==="granted")new Notification(t,{body:b});}

/* ====== ТАЙМЕР ====== */
const timerBox=document.getElementById("timerBox");
const statusText=document.getElementById("statusText");
const subText=document.getElementById("subText");
const BREAK_AFTER=3;
const BIG_BREAK=20;
let lastWarn="",lastEnd="";

function timeToMin(t){let[h,m]=t.split(":");return h*60+ +m;}
function fmt(s){let m=Math.floor(s/60);let sec=s%60;return String(m).padStart(2,"0")+":"+String(sec).padStart(2,"0");}

function tick(){
DAYS=buildWeek();
let todayISO=new Date().toISOString().split("T")[0];
let today=DAYS.find(d=>d.dateISO===todayISO);
if(!today){statusText.textContent="Бүгін сабақ жоқ";timerBox.textContent="00:00";return;}
subText.textContent=today.title;

let now=new Date();
let nowMin=now.getHours()*60+now.getMinutes();
let curSec=nowMin*60+now.getSeconds();

let timeline=[];
today.lessons.forEach((l,i)=>{
timeline.push({type:"lesson",idx:i+1,name:l[2],start:timeToMin(l[0]),end:timeToMin(l[1])});
if(i<today.lessons.length-1){
let next=timeToMin(today.lessons[i+1][0]);
let end=timeToMin(l[1]);
let breakEnd=(i+1===BREAK_AFTER)?end+BIG_BREAK:next;
timeline.push({type:"break",after:i+1,start:end,end:breakEnd});
}
});

let current=timeline.find(b=>nowMin>=b.start&&nowMin<b.end);
if(!current){statusText.textContent="Үзіліс/сабақ алдында";timerBox.textContent="00:00";return;}

let left=current.end*60-curSec;
timerBox.textContent=fmt(left);

if(current.type==="lesson"){
statusText.textContent=`Қазір: ${current.idx}-сабақ — ${current.name}`;
if(Math.ceil(left/60)===5&&lastWarn!==current.idx){
notify("5 минутта","Сабақ аяқталады");
lastWarn=current.idx;
}
if(left<=1&&lastEnd!==current.idx){
notify("Сабақ аяқталды",current.name);
lastEnd=current.idx;
}
}
}

renderButtons();
selectDay("mon");
setInterval(tick,1000);
tick();

/* ===== ZOOM DISABLE ===== */
document.addEventListener('touchmove',e=>{if(e.scale&&e.scale!==1)e.preventDefault()},{passive:false});
let lastTouchEnd=0;
document.addEventListener('touchend',e=>{
let now=Date.now();
if(now-lastTouchEnd<=300)e.preventDefault();
lastTouchEnd=now;
},{passive:false});
document.addEventListener('wheel',e=>{if(e.ctrlKey)e.preventDefault()},{passive:false});
document.addEventListener('keydown',e=>{
if(e.ctrlKey&&(['+','-','=','0'].includes(e.key)))e.preventDefault();
});
</script>

</body>
</html>